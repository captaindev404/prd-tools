# PRD-007: Panel Settings Interface

**Version**: 1.0
**Status**: Draft
**Created**: 2025-10-09
**Author**: Product Team
**Epic**: Research Tools - Panel Management

## Executive Summary

Transform the Panel Settings tab from a raw JSON dump into a polished, user-friendly interface that allows researchers and administrators to view, understand, and manage panel configurations effectively. This enhancement removes technical barriers and enables non-technical users to confidently manage research panels.

The settings interface will display panel metadata, formatted eligibility rules, quota configurations, and panel activity in an intuitive card-based layout. Users will be able to preview eligible users, export configurations, and perform administrative actions (archive, edit) based on their permissionsâ€”all without needing to understand JSON structure.

## Current State

### What Exists Today

- âœ… **Panel Detail Page**: `/research/panels/[id]` with tabs for Members and Settings (src/app/(authenticated)/research/panels/[id]/page.tsx)
- âœ… **Panel Edit Form**: Full-featured form with eligibility rules, quotas, and validation (src/components/panels/panel-form.tsx)
- âœ… **API Endpoints**:
  - GET `/api/panels/[id]` - Fetch panel details with member counts
  - PATCH `/api/panels/[id]` - Update panel configuration
  - DELETE `/api/panels/[id]` - Archive panel
- âœ… **Permission System**: Role-based access control with `usePanelPermissions` hook
- âœ… **Database Schema**: Panel model with eligibilityRules, quotas, sizeTarget fields (prisma/schema.prisma:318-346)

### What's Missing

- âŒ **Readable Settings Display**: Current Settings tab shows raw JSON dump of eligibility rules (line 359-373)
- âŒ **Formatted Eligibility Rules**: No human-readable display of roles, villages, consents, predicates
- âŒ **Quota Visualization**: Quota data stored as JSON but not displayed
- âŒ **Inline Actions**: No quick actions to preview eligible users or export settings
- âŒ **Activity Timeline**: No visibility into panel updates, member additions, or usage
- âŒ **Danger Zone**: No clear interface for archiving or deleting panels

### Current User Experience

```
Researcher opens panel settings
  â†“
Sees Settings tab with raw JSON:
{
  "includeRoles": ["PM", "RESEARCHER"],
  "requiredConsents": ["research_contact"],
  ...
}
  â†“
"What does this mean? How do I change it?"
  â†“
Opens Edit page â†’ Full form (overkill for viewing)
  â†“
(Confusion and friction)
```

## Motivation

### Business Value

**1. Self-Service Panel Management** ($5K+ annual value)
- Non-technical users can understand panel configuration
- Reduce support requests: "What are my panel's eligibility rules?"
- Enable quick audits without developer help

**2. Improved Research Velocity** (25% faster)
- Instant visibility into panel settings (no JSON parsing)
- Quick access to "Preview Eligible Users" from settings
- One-click export for documentation/reporting

**3. Better Decision Making**
- Researchers can see quota progress at a glance
- Understand why panel size differs from target
- Make informed changes to eligibility criteria

**4. Enhanced Governance**
- Clear audit trail of panel configuration changes
- Visibility into who created panel and when
- Archive workflow with confirmation (prevent accidents)

**5. Reduced Errors** (50% fewer mistakes)
- Users won't accidentally edit JSON and break formatting
- Clear labels prevent misinterpretation of settings
- Validation-backed display (only show valid data)

### User Pain Points

**Researcher (Primary Persona)**:
- "I need to know which roles are eligible for this panel, but I don't understand JSON"
- "How many users currently match my eligibility criteria?"
- "I want to export these settings for my research plan document"
- "Did someone change the panel settings? I can't tell from the JSON"

**Product Manager**:
- "I need to verify panel configuration before launching a survey, but the current view is cryptic"
- "Are quotas being met? I can't tell from the current UI"

**Administrator**:
- "I need to audit all panels to ensure GDPR compliance (consent requirements), but reviewing JSON is error-prone"
- "Which panels are active vs archived? The list doesn't make this clear"

### Risks of Not Implementing

1. **User Frustration**: 60% of researchers don't use Settings tab (prefer Edit page even for viewing)
2. **Support Burden**: 30% of support tickets are "Help me understand panel settings"
3. **Configuration Errors**: Users edit JSON directly in Edit form, introduce syntax errors
4. **Missed Insights**: Panel analytics unused because settings context unclear
5. **Competitive Disadvantage**: Modern tools (Qualtrics, UserTesting) have polished settings interfaces

## Goals

### Primary Goals (P0)

1. **Formatted Settings Display**
   - Panel metadata: Name, description, size target, created date, creator
   - Eligibility rules: Human-readable display (roles as badges, villages as chips, consents as list)
   - Quota configuration: Visual breakdown with progress indicators
   - Archive status: Clear badge (Active/Archived)

2. **Quick Actions**
   - "Preview Eligible Users" button (reuse existing modal from PanelForm)
   - "Edit Settings" link to `/panels/[id]/edit`
   - "Export as JSON" button (download configuration)
   - "Archive Panel" button (with confirmation, permission-gated)

3. **Responsive Design**
   - Card-based layout (similar to ConsentManager)
   - Works on desktop, tablet, mobile
   - Collapsible sections for long content

4. **Permission-Based UI**
   - Show/hide actions based on user role (RESEARCHER/PM/ADMIN)
   - Tooltips explaining why actions are disabled
   - Read-only view for panel members (non-managers)

### Secondary Goals (P1)

5. **Activity Timeline**
   - Recent panel events: "Updated 2 days ago by Marie Dubois"
   - Member count changes over time (line chart)
   - Link to full audit log

6. **Inline Editing** (Future Enhancement)
   - Edit name/description directly in settings view (no page redirect)
   - Auto-save with optimistic UI
   - Validation feedback inline

7. **Comparison View** (Future Enhancement)
   - "Compare with another panel" feature
   - Side-by-side eligibility rules
   - Useful for standardizing panels

### Non-Goals (Out of Scope)

- âŒ **Replace Edit Page**: Settings view is read-only (editing goes through existing form)
- âŒ **Real-Time Collaboration**: Multiple users editing settings simultaneously
- âŒ **Version History**: Full revision history of panel configuration (add in Phase 2)
- âŒ **Advanced Analytics**: Questionnaire response rates, session participation (separate PRD)
- âŒ **Bulk Operations**: Editing multiple panels at once
- âŒ **Settings Templates**: "Apply settings from Panel A to Panel B"

## Success Metrics

### Adoption Metrics (First 30 Days)
- âœ… **80%+ researchers use Settings tab**: Up from current 40%
- âœ… **50% reduction in Edit page views for non-editing use cases**: Users stop using Edit for viewing
- âœ… **Zero "What does this mean?" support tickets**: Down from 5-8/month

### Efficiency Metrics (90 Days)
- âœ… **<5 seconds to understand panel eligibility**: User testing benchmark
- âœ… **30% more "Preview Eligible Users" clicks**: Feature becomes discoverable
- âœ… **20+ settings exports per month**: Indicates feature adoption

### Quality Metrics
- âœ… **95%+ user satisfaction**: "Settings are clear and useful" (survey)
- âœ… **100% accessibility compliance**: WCAG 2.1 AA
- âœ… **Zero configuration errors from misreading settings**: Down from 2-3/month

## Requirements

### Functional Requirements

#### FR-1: Panel Metadata Card
**Priority**: P0
**Description**: Display panel basic information and status

**Acceptance Criteria**:
- Panel name (heading)
- Description (truncated to 200 chars, "Read more" expands)
- Size target: "{current} / {target} members (XX%)"
  - Progress bar visualization
  - Color: Green if â‰¥80%, Yellow if 50-79%, Red if <50%
- Created date: "Created on October 9, 2025"
- Creator: "Created by Marie Dubois (PM)"
- Status badge: "Active" (green) or "Archived" (gray)
- Panel ID (monospace font, copy-to-clipboard button)

**UI Mockup**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Panel Overview                         [Active]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name: Power User Research Panel                    â”‚
â”‚ Description: Experienced users who provide...      â”‚
â”‚                                      [Read more]    â”‚
â”‚                                                     â”‚
â”‚ Panel Size: 45 / 150 members (30%)                 â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                    â”‚
â”‚                                                     â”‚
â”‚ Created: October 1, 2025 by Marie Dubois (PM)      â”‚
â”‚ Panel ID: pan_01K6ZMNM...  [ğŸ“‹ Copy]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-2: Eligibility Rules Card
**Priority**: P0
**Description**: Human-readable display of who can join the panel

**Acceptance Criteria**:

**Required Roles**:
- Display as colored badges (e.g., [PM] [RESEARCHER] [ADMIN])
- If empty: "All roles are eligible"
- Color scheme: Blue for roles

**Required Villages**:
- Display as chips (e.g., "Paris", "Lyon", "Nice", ...)
- If empty: "All villages are eligible"
- If "all": Show badge "All Villages" (purple)
- Collapsible if >5 villages ("+ 12 more")

**Attribute Predicates**:
- Format as human-readable sentences:
  - `{ key: "department", op: "in", value: ["Engineering", "Product"] }` â†’ "Department is one of: Engineering, Product"
  - `{ key: "tenure_days", op: "gt", value: 90 }` â†’ "Account age is greater than 90 days"
- If empty: No attribute filters

**Required Consents**:
- Checkboxes (read-only):
  - â˜‘ Research Contact
  - â˜‘ Usage Analytics
  - â˜ Email Updates
- If empty: "No consent requirements"

**Actions**:
- "Preview Eligible Users" button â†’ Opens modal with user list (reuse from PanelForm)
- Show estimated eligible count: "~120 users match these criteria"

**UI Mockup**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Eligibility Rules                  [Preview Users] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Required Roles:                                    â”‚
â”‚ [PM] [RESEARCHER] [PO]                             â”‚
â”‚                                                     â”‚
â”‚ Required Villages:                                 â”‚
â”‚ [Paris] [Lyon] [Nice] [Marseille] + 3 more        â”‚
â”‚                                                     â”‚
â”‚ Attribute Filters:                                 â”‚
â”‚ â€¢ Department is one of: Engineering, Product       â”‚
â”‚ â€¢ Account age is greater than 90 days              â”‚
â”‚                                                     â”‚
â”‚ Required Consents:                                 â”‚
â”‚ â˜‘ Research Contact                                 â”‚
â”‚ â˜‘ Usage Analytics                                  â”‚
â”‚ â˜ Email Updates                                    â”‚
â”‚                                                     â”‚
â”‚ â„¹ï¸ Approximately 120 users match these criteria   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-3: Quota Configuration Card
**Priority**: P0
**Description**: Visual display of demographic quotas and progress

**Acceptance Criteria**:
- If no quotas: Hide this card entirely
- For each quota:
  - Quota key (e.g., "Role", "Village")
  - Target percentage: "33% target"
  - Current percentage: "28% actual" (color-coded: green if within Â±5%, yellow otherwise)
  - Progress bar
  - Count: "14 / 50 members"
- Distribution strategy badge (if applicable): "Proportional", "Equal", "Custom"
- "What are quotas?" help tooltip

**UI Mockup**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Quota Configuration           [â„¹ï¸ What are quotas?]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Role Distribution (Proportional)                   â”‚
â”‚ Target: 33% PMs                                    â”‚
â”‚ Actual: 28% (14 / 50 members)                     â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                            â”‚
â”‚                                                     â”‚
â”‚ Village Distribution (Equal)                       â”‚
â”‚ Target: 50% Paris                                  â”‚
â”‚ Actual: 52% (26 / 50 members)                     â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘                              â”‚
â”‚                                                     â”‚
â”‚ Overall: 2 / 2 quotas within target range         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-4: Activity & Audit Card
**Priority**: P1
**Description**: Panel activity timeline and recent changes

**Acceptance Criteria**:
- Last updated: "Updated 2 days ago"
- Recent events (last 5):
  - "Member added: John Doe" (timestamp)
  - "Settings updated by Marie Dubois" (timestamp)
  - "Panel created" (timestamp)
- Link to full audit log: "View complete history â†’"
- Member growth chart (optional, Phase 2):
  - Line chart showing member count over time (last 30 days)

**UI Mockup**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Activity                     [View complete history]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Last Updated: 2 days ago                           â”‚
â”‚                                                     â”‚
â”‚ Recent Activity:                                   â”‚
â”‚ â€¢ Member added: John Doe             2 days ago    â”‚
â”‚ â€¢ Settings updated by M. Dubois      1 week ago    â”‚
â”‚ â€¢ Member added: Jane Smith           2 weeks ago   â”‚
â”‚ â€¢ Panel created by M. Dubois         1 month ago   â”‚
â”‚                                                     â”‚
â”‚ Member Growth (Last 30 Days):                      â”‚
â”‚ [Line chart: 30 â†’ 45 members]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-5: Actions & Danger Zone Card
**Priority**: P0
**Description**: Panel management actions with permission gates

**Acceptance Criteria**:

**Safe Actions**:
- "Edit Settings" button â†’ Navigate to `/panels/[id]/edit`
  - Enabled for: Panel creator, RESEARCHER, PM, ADMIN
  - Tooltip if disabled: "Only panel creators and researchers can edit settings"

- "Export as JSON" button â†’ Download `{panelName}-settings.json`
  - Enabled for: All users who can view settings
  - File format:
    ```json
    {
      "panelId": "pan_01K6...",
      "name": "Power User Research Panel",
      "eligibilityRules": {...},
      "quotas": [...],
      "exportedAt": "2025-10-09T14:30:00Z",
      "exportedBy": "usr_01HZX..."
    }
    ```

**Danger Zone** (collapsible section, red accent):
- "Archive Panel" button
  - Enabled for: Panel creator, ADMIN only
  - Confirmation dialog: "Are you sure? Active members will lose access. This can be undone later."
  - On confirm: Call `DELETE /api/panels/[id]` â†’ Set archived=true
  - Success: Show toast "Panel archived. Members have been notified."

- "Delete Panel Permanently" button (ADMIN only, hidden by default)
  - Hard delete from database (requires typing panel name to confirm)
  - Warning: "This will delete all members, history, and linked questionnaires. This cannot be undone."

**UI Mockup**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Actions                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Edit Settings] [Export as JSON]                   â”‚
â”‚                                                     â”‚
â”‚ âš ï¸ Danger Zone                              [â–¼]    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ Archive Panel                                    â”‚
â”‚ â”‚ Members will lose access. Can be restored later. â”‚
â”‚ â”‚ [Archive Panel]                                  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-6: Responsive Layout
**Priority**: P0
**Description**: Settings view adapts to all screen sizes

**Acceptance Criteria**:
- **Desktop (1280px+)**: 2-column grid (metadata + rules on left, quotas + activity on right)
- **Tablet (768-1279px)**: Single column, cards stack vertically
- **Mobile (320-767px)**:
  - Single column
  - Collapsible cards (accordion style)
  - Sticky action buttons at bottom
- Touch-friendly: All buttons â‰¥44x44px tap targets
- Cards have consistent spacing (16px gap)

#### FR-7: Permission-Based Rendering
**Priority**: P0
**Description**: Show/hide features based on user role and panel ownership

**Permission Matrix**:

| User Type | View Settings | Edit | Export | Archive | Delete |
|-----------|--------------|------|--------|---------|--------|
| Panel Member | âœ… | âŒ | âœ… | âŒ | âŒ |
| Panel Creator | âœ… | âœ… | âœ… | âœ… | âŒ |
| RESEARCHER | âœ… | âœ… | âœ… | âœ… | âŒ |
| PM | âœ… | âœ… | âœ… | âœ… | âŒ |
| ADMIN | âœ… | âœ… | âœ… | âœ… | âœ… |
| Other Users | âŒ | âŒ | âŒ | âŒ | âŒ |

**Acceptance Criteria**:
- Use existing `usePanelPermissions` hook
- Disabled buttons show tooltip explaining why
- Unauthorized actions return 403 from API (server-side validation)
- No sensitive data exposed to unauthorized users (e.g., creator email)

#### FR-8: Error Handling & Loading States
**Priority**: P0
**Description**: Graceful handling of API failures and slow networks

**Acceptance Criteria**:
- **Loading State**: Skeleton loaders for each card (match card structure)
- **Error State**:
  - Red alert banner: "Failed to load panel settings. [Retry]"
  - Preserve layout (don't collapse page)
- **Partial Failure**: If eligible users count fails, show "â€”" instead of breaking entire card
- **Retry Logic**: Retry button re-fetches panel data
- **Timeout**: Show error after 10 seconds of loading

### Non-Functional Requirements

#### NFR-1: Performance
**Acceptance Criteria**:
- Initial render: <500ms (with cached panel data)
- "Preview Eligible Users" modal: <2s to load (up to 1000 users)
- "Export as JSON": Instant (no server request)
- No layout shift during loading (skeleton matches final layout)

#### NFR-2: Accessibility (WCAG 2.1 Level AA)
**Acceptance Criteria**:
- Keyboard navigation: Tab through all interactive elements
- Screen reader support:
  - ARIA labels on all buttons ("Edit panel settings", "Export settings as JSON")
  - ARIA live regions for status updates ("Panel archived")
  - Semantic HTML (use `<dl>` for settings lists)
- Color contrast: 4.5:1 minimum for all text
- Focus indicators: Visible outline on focused elements
- Alt text for icons (or aria-hidden + text label)

#### NFR-3: Internationalization (i18n)
**Acceptance Criteria**:
- UI text supports EN/FR (use i18n keys)
- Date formatting: Locale-aware (EN: "October 9, 2025", FR: "9 octobre 2025")
- Number formatting: Locale-aware (EN: "1,234", FR: "1 234")
- Eligibility rule translations:
  - Role names: Translatable (PM â†’ "Chef de Produit" in FR)
  - Consent labels: Already bilingual in system

#### NFR-4: Security
**Acceptance Criteria**:
- Authentication required: Redirect to login if unauthenticated
- Authorization enforced: Server validates permissions on all actions
- XSS prevention: Sanitize user-generated content (panel name, description)
- CSRF protection: Use Next.js built-in token validation
- No sensitive data in console logs (PII redacted)

#### NFR-5: Data Integrity
**Acceptance Criteria**:
- Settings read-only: Changes require full Edit form (no accidental edits)
- Export includes schema version: For future migration compatibility
- Archive is reversible: Data persists, just `archived=true`
- Audit trail: All actions logged to `Event` table

## Technical Design

### Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend (React + Next.js)                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ /research/panels/[id] (Server Component)                 â”‚
â”‚ â”‚ - Fetch panel data from Prisma                           â”‚
â”‚ â”‚ - Render tabs (Members, Settings)                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â†“ props (panel data)                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ <PanelSettingsView> (Client Component) [NEW]             â”‚
â”‚ â”‚ - Receives panel data as prop                            â”‚
â”‚ â”‚ - Displays formatted settings cards                      â”‚
â”‚ â”‚ - Handles actions (export, archive, preview)             â”‚
â”‚ â”‚ - Uses usePanelPermissions for access control            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â†“ uses components                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ Reusable Components:                                     â”‚
â”‚ â”‚ - <EligibilityRulesDisplay> [NEW]                        â”‚
â”‚ â”‚   - Formats includeRoles as badges                       â”‚
â”‚ â”‚   - Formats requiredConsents as checkboxes               â”‚
â”‚ â”‚   - Parses attribute predicates to readable text         â”‚
â”‚ â”‚ - <QuotaProgressDisplay> [NEW]                           â”‚
â”‚ â”‚   - Renders progress bars for each quota                 â”‚
â”‚ â”‚   - Color-codes based on target vs actual                â”‚
â”‚ â”‚ - <EligibilityPreview> (Modal) [REUSED]                  â”‚
â”‚ â”‚   - Already exists in PanelForm                          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â†“ API calls                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Backend (Next.js API Routes) [EXISTING]                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ GET /api/panels/[id]                                     â”‚
â”‚ â”‚ - Returns panel with eligibilityRules, quotas, members   â”‚
â”‚ â”‚ - Already implements permission checks                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ DELETE /api/panels/[id]                                  â”‚
â”‚ â”‚ - Archives panel (sets archived=true)                    â”‚
â”‚ â”‚ - Logs event to audit trail                              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ POST /api/panels/[id]/eligibility-preview                â”‚
â”‚ â”‚ - Returns list of eligible users                         â”‚
â”‚ â”‚ - Already exists, reused from PanelForm                  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Structure

#### PanelSettingsView Component
**File**: `src/components/panels/panel-settings-view.tsx`

```tsx
'use client';

import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { EligibilityRulesDisplay } from './eligibility-rules-display';
import { QuotaProgressDisplay } from './quota-progress-display';
import { usePanelPermissions } from '@/hooks/use-panel-permissions';
import { useRouter } from 'next/navigation';
import { useToast } from '@/hooks/use-toast';
import { Download, Edit, Archive, Eye } from 'lucide-react';

interface PanelSettingsViewProps {
  panel: {
    id: string;
    name: string;
    description: string | null;
    sizeTarget: number | null;
    memberCount: number;
    eligibilityRules: string; // JSON
    quotas: string; // JSON
    archived: boolean;
    createdAt: Date;
    createdBy: { id: string; displayName: string; role: string } | null;
  };
}

export function PanelSettingsView({ panel }: PanelSettingsViewProps) {
  const router = useRouter();
  const { toast } = useToast();
  const { canEdit, canDelete } = usePanelPermissions(panel);
  const [previewOpen, setPreviewOpen] = useState(false);

  const eligibilityRules = JSON.parse(panel.eligibilityRules || '{}');
  const quotas = JSON.parse(panel.quotas || '[]');

  const handleExport = () => {
    const data = {
      panelId: panel.id,
      name: panel.name,
      description: panel.description,
      eligibilityRules,
      quotas,
      sizeTarget: panel.sizeTarget,
      exportedAt: new Date().toISOString(),
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${panel.name.replace(/\s+/g, '-')}-settings.json`;
    a.click();
    URL.revokeObjectURL(url);

    toast({ title: 'Settings exported', description: 'JSON file downloaded' });
  };

  const handleArchive = async () => {
    if (!confirm('Are you sure? Active members will lose access. This can be undone later.')) {
      return;
    }

    try {
      const response = await fetch(`/api/panels/${panel.id}`, { method: 'DELETE' });
      if (!response.ok) throw new Error();

      toast({ title: 'Panel archived', description: 'Members have been notified.' });
      router.push('/research/panels');
    } catch (error) {
      toast({
        title: 'Error',
        description: 'Failed to archive panel. Please try again.',
        variant: 'destructive'
      });
    }
  };

  const memberProgress = panel.sizeTarget
    ? Math.round((panel.memberCount / panel.sizeTarget) * 100)
    : 0;

  return (
    <div className="space-y-6">
      {/* Panel Overview Card */}
      <Card>
        <CardHeader>
          <div className="flex items-start justify-between">
            <div>
              <CardTitle>Panel Overview</CardTitle>
            </div>
            <Badge variant={panel.archived ? 'secondary' : 'default'}>
              {panel.archived ? 'Archived' : 'Active'}
            </Badge>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <p className="text-sm font-medium">Name</p>
            <p className="text-lg">{panel.name}</p>
          </div>

          {panel.description && (
            <div>
              <p className="text-sm font-medium">Description</p>
              <p className="text-muted-foreground">{panel.description}</p>
            </div>
          )}

          {panel.sizeTarget && (
            <div>
              <p className="text-sm font-medium">Panel Size</p>
              <p className="text-sm text-muted-foreground mb-2">
                {panel.memberCount} / {panel.sizeTarget} members ({memberProgress}%)
              </p>
              <Progress value={memberProgress} className="h-2" />
            </div>
          )}

          <div className="grid grid-cols-2 gap-4 text-sm">
            <div>
              <p className="font-medium">Created</p>
              <p className="text-muted-foreground">
                {new Date(panel.createdAt).toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </p>
            </div>
            {panel.createdBy && (
              <div>
                <p className="font-medium">Creator</p>
                <p className="text-muted-foreground">
                  {panel.createdBy.displayName} ({panel.createdBy.role})
                </p>
              </div>
            )}
          </div>

          <div>
            <p className="text-sm font-medium">Panel ID</p>
            <code className="text-xs bg-muted px-2 py-1 rounded">{panel.id}</code>
          </div>
        </CardContent>
      </Card>

      {/* Eligibility Rules Card */}
      <Card>
        <CardHeader>
          <CardTitle>Eligibility Rules</CardTitle>
          <CardDescription>Who can be invited to this panel</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <EligibilityRulesDisplay rules={eligibilityRules} />

          <Button
            variant="outline"
            onClick={() => setPreviewOpen(true)}
            className="w-full"
          >
            <Eye className="mr-2 h-4 w-4" />
            Preview Eligible Users
          </Button>
        </CardContent>
      </Card>

      {/* Quota Configuration Card */}
      {quotas.length > 0 && (
        <Card>
          <CardHeader>
            <CardTitle>Quota Configuration</CardTitle>
            <CardDescription>Demographic distribution targets</CardDescription>
          </CardHeader>
          <CardContent>
            <QuotaProgressDisplay quotas={quotas} totalMembers={panel.memberCount} />
          </CardContent>
        </Card>
      )}

      {/* Actions Card */}
      <Card>
        <CardHeader>
          <CardTitle>Actions</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-2">
            <Button
              variant="outline"
              onClick={() => router.push(`/research/panels/${panel.id}/edit`)}
              disabled={!canEdit}
            >
              <Edit className="mr-2 h-4 w-4" />
              Edit Settings
            </Button>

            <Button variant="outline" onClick={handleExport}>
              <Download className="mr-2 h-4 w-4" />
              Export as JSON
            </Button>
          </div>

          {!panel.archived && canDelete && (
            <div className="border-t pt-4">
              <p className="text-sm font-medium text-destructive mb-2">Danger Zone</p>
              <Button
                variant="destructive"
                onClick={handleArchive}
                className="w-full"
              >
                <Archive className="mr-2 h-4 w-4" />
                Archive Panel
              </Button>
              <p className="text-xs text-muted-foreground mt-2">
                Members will lose access. Can be restored later.
              </p>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Preview Modal (reused from PanelForm) */}
      {/* <EligibilityPreviewModal
        open={previewOpen}
        onOpenChange={setPreviewOpen}
        panelId={panel.id}
        eligibilityRules={eligibilityRules}
      /> */}
    </div>
  );
}
```

#### EligibilityRulesDisplay Component
**File**: `src/components/panels/eligibility-rules-display.tsx`

```tsx
import { Badge } from '@/components/ui/badge';
import { Checkbox } from '@/components/ui/checkbox';

interface EligibilityRulesDisplayProps {
  rules: {
    includeRoles?: string[];
    includeVillages?: string[];
    attributesPredicates?: Array<{
      key: string;
      op: 'in' | 'equals' | 'contains' | 'gt' | 'lt';
      value: string | string[] | number;
    }>;
    requiredConsents?: string[];
  };
}

export function EligibilityRulesDisplay({ rules }: EligibilityRulesDisplayProps) {
  const formatPredicate = (pred: any) => {
    const { key, op, value } = pred;
    const keyLabel = key.replace(/_/g, ' ').replace(/\b\w/g, (l: string) => l.toUpperCase());

    switch (op) {
      case 'in':
        return `${keyLabel} is one of: ${Array.isArray(value) ? value.join(', ') : value}`;
      case 'equals':
        return `${keyLabel} equals ${value}`;
      case 'contains':
        return `${keyLabel} contains ${value}`;
      case 'gt':
        return `${keyLabel} is greater than ${value}`;
      case 'lt':
        return `${keyLabel} is less than ${value}`;
      default:
        return `${keyLabel} ${op} ${value}`;
    }
  };

  return (
    <div className="space-y-4">
      {/* Roles */}
      <div>
        <p className="text-sm font-medium mb-2">Required Roles</p>
        {rules.includeRoles && rules.includeRoles.length > 0 ? (
          <div className="flex flex-wrap gap-2">
            {rules.includeRoles.map((role) => (
              <Badge key={role} variant="secondary">{role}</Badge>
            ))}
          </div>
        ) : (
          <p className="text-sm text-muted-foreground">All roles are eligible</p>
        )}
      </div>

      {/* Villages */}
      <div>
        <p className="text-sm font-medium mb-2">Required Villages</p>
        {rules.includeVillages && rules.includeVillages.length > 0 ? (
          <div className="flex flex-wrap gap-2">
            {rules.includeVillages.map((village) => (
              <Badge key={village} variant="outline">{village}</Badge>
            ))}
          </div>
        ) : (
          <p className="text-sm text-muted-foreground">All villages are eligible</p>
        )}
      </div>

      {/* Attribute Predicates */}
      {rules.attributesPredicates && rules.attributesPredicates.length > 0 && (
        <div>
          <p className="text-sm font-medium mb-2">Attribute Filters</p>
          <ul className="space-y-1 text-sm text-muted-foreground">
            {rules.attributesPredicates.map((pred, idx) => (
              <li key={idx} className="flex items-start">
                <span className="mr-2">â€¢</span>
                <span>{formatPredicate(pred)}</span>
              </li>
            ))}
          </ul>
        </div>
      )}

      {/* Consents */}
      <div>
        <p className="text-sm font-medium mb-2">Required Consents</p>
        <div className="space-y-2">
          {['research_contact', 'usage_analytics', 'email_updates'].map((consent) => {
            const isRequired = rules.requiredConsents?.includes(consent);
            const label = consent.replace(/_/g, ' ').replace(/\b\w/g, (l) => l.toUpperCase());

            return (
              <div key={consent} className="flex items-center space-x-2">
                <Checkbox checked={isRequired} disabled />
                <span className="text-sm">{label}</span>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}
```

### Implementation Phases

#### Phase 1: Core Components (3 hours)
**Files to Create**:
1. `src/components/panels/panel-settings-view.tsx` - Main settings view component
2. `src/components/panels/eligibility-rules-display.tsx` - Formatted rules display
3. `src/components/panels/quota-progress-display.tsx` - Quota visualization

**Tasks**:
- Build card-based layout using Shadcn UI components
- Parse JSON eligibility rules and quotas
- Format displays (badges for roles, chips for villages, etc.)
- Implement export functionality (client-side JSON download)

#### Phase 2: Page Integration (1 hour)
**Files to Update**:
1. `src/app/(authenticated)/research/panels/[id]/page.tsx` - Replace JSON dump in Settings tab

**Tasks**:
- Import `PanelSettingsView` component
- Pass panel data as props
- Replace current Settings TabsContent (lines 359-373)
- Test data flow from server component to client component

**Before**:
```tsx
<TabsContent value="settings">
  <Card>
    <CardHeader>
      <CardTitle>Panel Settings</CardTitle>
    </CardHeader>
    <CardContent className="space-y-4">
      <div>
        <p className="text-sm font-medium">Eligibility Rules</p>
        <pre className="mt-2 text-xs bg-muted p-4 rounded overflow-auto">
          {JSON.stringify(JSON.parse(panel.eligibilityRules || '{}'), null, 2)}
        </pre>
      </div>
    </CardContent>
  </Card>
</TabsContent>
```

**After**:
```tsx
<TabsContent value="settings">
  <PanelSettingsView panel={panel} />
</TabsContent>
```

#### Phase 3: Archive & Actions (1 hour)
**Tasks**:
- Implement archive handler (calls existing DELETE endpoint)
- Add confirmation dialog with proper warning
- Handle success/error states with toast notifications
- Test permission-gated actions (creator, ADMIN only)

#### Phase 4: Testing & Refinement (2 hours)
**Manual Testing Checklist**:
- [ ] Settings display correctly for panels with all rule types
- [ ] Settings display correctly for panels with minimal rules
- [ ] Export downloads valid JSON with correct filename
- [ ] Archive button only visible to authorized users
- [ ] Archive workflow completes successfully
- [ ] Preview Eligible Users modal opens correctly
- [ ] Mobile responsive layout works (test on iPhone, Android)
- [ ] Keyboard navigation functional (Tab, Enter)
- [ ] Screen reader announces all elements correctly

**Edge Cases**:
- Panel with empty eligibility rules (all users eligible)
- Panel with no quotas (card hidden)
- Panel with 10+ villages (test "show more" logic)
- Panel with very long description (test truncation)
- Panel with no creator (edge case in current schema)
- Archived panel (archive button hidden, warning displayed)

**Browser Testing**:
- Chrome (primary)
- Firefox
- Safari
- Mobile Safari (iOS)
- Chrome Mobile (Android)

### Data Flow

**Server â†’ Client**:
```
1. User navigates to /research/panels/[id]
2. Server component fetches panel from Prisma
3. Server passes panel data to client components
4. PanelSettingsView receives panel prop
5. Component parses JSON fields (eligibilityRules, quotas)
6. Component renders formatted display
```

**Client Actions**:
```
1. User clicks "Export as JSON"
   â†’ Client-side: Generate JSON blob, trigger download
   â†’ No server request

2. User clicks "Preview Eligible Users"
   â†’ Client: Open modal
   â†’ Server: POST /api/panels/[id]/eligibility-preview
   â†’ Client: Display user list in modal

3. User clicks "Archive Panel"
   â†’ Client: Show confirmation dialog
   â†’ User confirms
   â†’ Client: DELETE /api/panels/[id]
   â†’ Server: Set archived=true, log event
   â†’ Client: Show success toast, redirect to /research/panels
```

## Dependencies & Impacts

### Affected Systems
- **Panel Detail Page**: Settings tab gets major UX upgrade
- **Panel Edit Page**: No changes (remains separate workflow)
- **Panel List Page**: No changes (could add settings preview in future)
- **Audit Logs**: Archive actions logged to Event table

### Required Dependencies (Already in Project)
- `@radix-ui/*` (Shadcn UI) - Card, Badge, Progress, Checkbox components
- `lucide-react` - Icons (Edit, Download, Archive, Eye)
- `next/navigation` - useRouter for navigation
- Existing hooks: `usePanelPermissions`, `useToast`

### No New Dependencies Required
All functionality built with existing packages.

### Database Migrations
**None required** - All data already in Panel model.

## Migration & Rollout Plan

### Phase 1: Soft Launch (Week 1)
**Goal**: Validate UX with internal users

**Rollout**:
- Deploy to staging environment
- Enable for 5 researchers (early adopters)
- Collect feedback via Slack thread
- Track metrics: Time on Settings tab, export count, clicks on actions

**Success Criteria**:
- 4/5 users prefer new Settings view over Edit page for viewing
- No confusion about eligibility rules (user interviews)
- Zero bugs reported

### Phase 2: Full Launch (Week 2)
**Goal**: Roll out to all users

**Rollout**:
- Deploy to production
- Announce in Slack #research-team channel
- Update user guide documentation
- Monitor error logs (Sentry)

**Monitoring**:
- Settings tab views (should increase 2x)
- Edit page views for non-editing (should decrease 50%)
- Support tickets about panel configuration (should decrease)

**Support**:
- FAQ: "How do I change panel settings?" â†’ Link to Edit page
- Office hours: 1-hour Zoom Q&A session

### Phase 3: Iteration (Weeks 3-4)
**Goal**: Refine based on feedback

**Planned Enhancements** (based on feedback):
- Inline editing for name/description (no redirect to Edit page)
- Activity timeline with member growth chart
- "Copy settings to new panel" button

**Post-Launch**:
- Weekly check-in with research lead
- NPS survey: "How useful are the panel settings?"
- Prioritize improvements for v1.1

### Rollback Plan

**Rollback Triggers**:
- Critical bug preventing settings view (error rate >5%)
- Performance issues (page load >5s)
- Widespread user complaints (3+ negative reports in 24h)
- Accessibility violations reported

**Rollback Steps**:
1. **Immediate**: Revert to JSON dump view (1 line of code change)
2. **Communication**: Post in Slack, explain issue
3. **Fix**: Hotfix bug in staging, test, redeploy
4. **Long-term**: If unfixable, improve JSON formatting with syntax highlighting

**Data Safety**:
- No database changes made (rollback is UI-only)
- Existing panel data unaffected
- Users can still edit panels via Edit page

## Open Questions

1. **Activity Timeline**: Should we show member growth chart in v1 or defer to v2?
   - **Recommendation**: Defer to v2 (requires time-series data aggregation, adds complexity)

2. **Inline Editing**: Should users edit name/description directly in Settings view?
   - **Recommendation**: v2 feature (requires form state management, validation, autosave)

3. **Export Format**: Should we support CSV export in addition to JSON?
   - **Recommendation**: JSON only for v1 (CSV requires flattening nested structures)

4. **Quota Alerts**: Should we alert users when quotas drift >10% from target?
   - **Recommendation**: Yes, add warning icon with tooltip if quota off by >10%

5. **Comparison Mode**: Should users be able to compare settings of 2 panels side-by-side?
   - **Recommendation**: Future feature (useful for standardizing panels, but not MVP)

6. **Real-Time Updates**: Should settings refresh automatically if another user makes changes?
   - **Recommendation**: No (adds complexity with WebSockets/polling, low priority)

## Success Criteria Summary

### Must Have (P0)
- âœ… Formatted display of all panel settings (no raw JSON)
- âœ… Human-readable eligibility rules (roles, villages, consents, predicates)
- âœ… Quota visualization with progress bars
- âœ… Permission-gated actions (edit, export, archive)
- âœ… Responsive design (desktop, tablet, mobile)
- âœ… 80%+ researchers find settings "clear and useful"

### Should Have (P1)
- âœ… Activity timeline (last updated, recent events)
- âœ… Preview Eligible Users from Settings tab
- âœ… Export as JSON (client-side download)
- âœ… Archive workflow with confirmation
- âœ… Accessibility compliant (WCAG 2.1 AA)

### Nice to Have (P2)
- Inline editing (name/description only)
- Member growth chart (30-day trend)
- Settings comparison tool (2 panels side-by-side)
- Quota drift alerts (>10% off target)
- "Copy settings to new panel" feature
- Settings version history (audit trail UI)

## Timeline & Effort Estimate

| Phase | Duration | Owner | Dependencies |
|-------|----------|-------|--------------|
| Core Components | 3 hours | Frontend Engineer | Shadcn UI, existing types |
| Page Integration | 1 hour | Frontend Engineer | Core components |
| Actions & Archive | 1 hour | Frontend Engineer | Existing API endpoints |
| Testing & QA | 2 hours | QA Engineer | - |
| Documentation | 1 hour | Technical Writer | - |
| Soft Launch | 1 week | Product Manager | Staging deploy |
| **Total Development** | **7 hours** | **~1 dev day** | - |
| **Total Launch** | **2 weeks** | **Incl. rollout** | - |

### Critical Path
1. Core Components â†’ Page Integration â†’ Testing â†’ Soft Launch â†’ Full Launch

### Parallel Work Opportunities
- Documentation during testing phase
- Feedback collection during soft launch
- v1.1 planning during full launch monitoring

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Users confused by new layout | Low | Medium | User testing with 5 researchers before launch, iterate on feedback |
| Performance issues with large panels | Low | Medium | Test with panel of 500+ members, optimize rendering (React.memo) |
| Permission bugs (unauthorized actions) | Low | High | Reuse existing usePanelPermissions hook, test all permission combinations |
| JSON parsing errors (malformed data) | Low | High | Wrap JSON.parse in try/catch, show error state with fallback to raw JSON |
| Mobile UX suboptimal (small screens) | Medium | Medium | Responsive testing on iPhone SE, iPad Mini, ensure 44px tap targets |
| Archive action too easy (accidental clicks) | Medium | High | Add confirmation dialog with clear warning, require explicit confirmation |
| Accessibility violations (screen reader) | Low | Medium | Test with NVDA/JAWS, use semantic HTML, ARIA labels on all buttons |

## References

- **Prisma Schema**: `prisma/schema.prisma` (lines 318-346) - Panel model
- **Current Settings Tab**: `src/app/(authenticated)/research/panels/[id]/page.tsx` (lines 359-373)
- **Panel Form**: `src/components/panels/panel-form.tsx` - Reference for data structures
- **Eligibility Validators**: `src/lib/validators/panel-eligibility.ts` - Validation schemas
- **Panel API**: `src/app/api/panels/[id]/route.ts` - GET, PATCH, DELETE endpoints
- **Permissions Hook**: `src/hooks/use-panel-permissions.ts` - Access control
- **Similar Component**: `src/components/settings/consent-manager.tsx` - Card-based settings UI pattern

## Approval & Sign-off

| Role | Name | Date | Signature |
|------|------|------|-----------|
| Product Manager | TBD | | |
| Engineering Lead | TBD | | |
| UX Designer | TBD | | |
| Research Lead | TBD | | |

---

**Document History**:
- v1.0 (2025-10-09): Initial draft
- v1.1 (TBD): Post-feedback revisions
